

# Функциональные требования (MVP)

## 1. Аутентификация и пользователь
**Статус:** реализовано (локальный Django UI, октябрь 2025).
- Вход по логину и паролю.
- Хранение Telethon-ключей и сессии пользователя.
- Базовые настройки пользователя (например, имя, email, смена пароля).

## 2. Проекты и источники
**Статус:** реализовано (модели Project/Source, управление через админку, октябрь 2025).
- Создание и удаление проектов.
- Для каждого проекта:
  - Указание одного или нескольких каналов-источников (Telegram).
  - Настройка фильтрации постов по ключевым словам (whitelist/blacklist).
  - Включение/отключение дедупликации постов по тексту/медиа.
  - Указание срока хранения постов (например, 7 дней).

## 3. Сбор и хранение постов
**Статус:** реализовано (команда `collect_posts`, хранение в Post/SourceSyncLog, октябрь 2025).
- Структура поста:
  - ID, источник, текст, медиа (фото/видео), дата публикации, статус обработки.
- Статусы постов: "новый", "в обработке", "использован", "удалён".
- Дедупликация постов по тексту и/или медиа.
- Сохранение текста и медиафайлов (фото/видео) в файловой системе/БД.
- Автоматическое удаление медиафайлов через 5 дней после сбора.

## 4. Сюжеты и рерайт
- Создание сюжета на основе одного или нескольких постов.
- Возможность добавления комментария редактора к сюжету.
- Отправка текста сюжета (и комментария) в OpenAI для рерайта.
- Получение ответа в формате JSON (структурированный текст, блоки, заголовки).
- Автоматическая обрезка длинных текстов по лимиту OpenAI.
- Ретраи при ошибках работы с OpenAI (ограниченное число попыток).
- Автосохранение черновика сюжета.
- Предпросмотр результата рерайта до публикации.

## 5. Публикация
- Чекбокс подтверждения готовности к публикации.
- Предпросмотр итогового материала перед отправкой.
- Публикация текста и медиа отдельными сообщениями (если есть медиа).
- При ошибке публикации — отмена всей публикации (никакой части не публикуется).
- В случае FLOOD_WAIT — ручное подтверждение/решение пользователем.
- Сохранение и отображение ссылки на опубликованный пост.

## 6. Генерация изображений
- Отдельное окно для генерации изображения.
- Поле для комментария/описания к генерации.
- Превью сгенерированного изображения.
- Возможность перегенерировать изображение.
- Прикрепление одной выбранной картинки к сюжету.
- Хранение только прикреплённых изображений, остальные удаляются.

## 7. Ошибки и уведомления
- Визуальные плашки ошибок в интерфейсе (toast/snackbar).
- Уведомления при сбоях работы с Telegram/OpenAI.
- Отображение статусов текущих задач и операций.
- Отсутствие централизованного журнала ошибок или подробной истории ошибок.

## 8. Интерфейс (WebUI)
- Структурированная навигация:
  - Список проектов.
  - Лента постов с фильтрами (по статусу, источнику, ключевым словам).
  - Мультивыбор постов.
  - Карточки проектов.
  - Предпросмотр сюжета.
  - Модальное окно для генерации изображений.

## 9. Ограничения MVP
- Не входит в первую версию:
  - Поддержка альбомов (множественных медиа в одном посте/публикации).
  - Markdown-редактор и расширенное форматирование текста.
  - Совместная работа нескольких пользователей над одним проектом.
  - Интеграция с S3 или внешними хранилищами для медиа.
  - Расширенные роли и права доступа.
  - Настраиваемые шаблоны публикаций.
  - Подробная история изменений и логирование действий.
