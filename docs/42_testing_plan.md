# Testing Plan

## 1. Цели тестирования
Тестирование проводится для подтверждения корректной работы всех компонентов проекта, обеспечения стабильности и надежности системы, выявления и устранения ошибок на ранних этапах разработки, а также для гарантии соответствия функционала требованиям.

## 2. Область покрытия
- Бэкенд: API, бизнес-логика, базы данных  
- Воркеры: асинхронные задачи, обработка очередей  
- Интеграции: взаимодействие с внешними сервисами (Telethon, OpenAI, публикация)  
- WebUI: пользовательский интерфейс, взаимодействие с пользователем  

## 3. Типы тестирования
- Юнит-тесты — проверка отдельных функций и методов  
- Интеграционные тесты — проверка взаимодействия между компонентами  
- End-to-end (E2E) — проверка полного пользовательского сценария  
- Приёмочные тесты — проверка соответствия требованиям заказчика  
- Нагрузочные тесты — оценка производительности и устойчивости под нагрузкой  

## 4. План тестирования по компонентам

| Компонент               | Что тестируется                              | Как тестируется                          |
|------------------------|---------------------------------------------|-----------------------------------------|
| Аутентификация          | Регистрация, вход, выход, восстановление пароля | Юнит и интеграционные тесты API         |
| Проекты и источники     | Создание, редактирование, удаление           | Юнит и интеграционные тесты              |
| Сбор постов            | Получение данных из источников                | Интеграционные тесты, мокинг внешних сервисов |
| Сюжеты и рерайт         | Генерация и обработка текстов                 | Юнит и интеграционные тесты с OpenAI    |
| Публикация             | Отправка постов в каналы и соцсети            | Интеграционные и E2E тесты               |
| Генерация изображений   | Создание и сохранение изображений             | Юнит и интеграционные тесты              |
| Очереди и ретраи       | Обработка задач, повторные попытки            | Юнит-тесты очереди (`core.tests.WorkerQueueTests`), интеграционные тесты воркеров |
| UI и пользовательские потоки | Навигация, формы, отображение данных        | E2E и приёмочные тесты                    |

**Обновление 20.10.2025**
- Добавлены unit-тесты для мастера Telethon, покрывающие повторный запрос SMS и
  сценарий, когда Telegram не может отправить код (`SendCodeUnavailable`).
- Проверка выхода из веб-интерфейса теперь охватывает GET-запрос к `/accounts/logout/`.

## 5. Интеграционное тестирование
Проверяется корректность взаимодействия между Telethon (Telegram API), OpenAI (генерация контента) и модулем публикации. Используются мок-объекты и тестовые окружения для имитации внешних сервисов.

## 6. E2E сценарии
- Логин пользователя и проверка доступа к функционалу  
- Создание нового проекта и добавление источников  
- Сбор постов и генерация сюжетов с помощью OpenAI  
- Публикация сгенерированного контента в Telegram канал  
- Обработка ошибок и повторные попытки при сбоях  
- Взаимодействие пользователя с UI: навигация, формы, уведомления  

## 7. Тестовые данные и фикстуры
Тестовые данные создаются с помощью factory_boy и фикстур Django. Для интеграционных тестов используются мок-объекты и заглушки. После тестов данные очищаются автоматически через транзакции и сброс базы.

## 8. Инструменты и фреймворки
- pytest — запуск и организация тестов  
- factory_boy — генерация тестовых данных  
- Django TestCase — интеграционные тесты с базой данных  
- mock — создание заглушек и мок-объектов для внешних сервисов  

## 9. Критерии успешного тестирования
- Все юнит и интеграционные тесты проходят без ошибок  
- E2E сценарии выполняются успешно на тестовом окружении  
- Нагрузочные тесты показывают приемлемую производительность  
- Отсутствие критических багов и ошибок в логах  
- Подтверждение соответствия требованиям заказчика  

## 10. Автоматизация и CI
Тесты запускаются автоматически при каждом пуше в ветки разработки и перед слиянием в основную ветку. Используется CI/CD система, которая выполняет полный набор тестов, анализ покрытия и статический анализ кода. При успешном прохождении тестов производится деплой на тестовое окружение.
