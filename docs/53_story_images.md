# Изображения сюжета

## Цель
Организовать работу редактора с изображениями сюжета: получать рекомендации промпта, генерировать иллюстрации, выбирать изображения из источников и управлять тем, какие медиа будут опубликованы.

## Основные страницы
- `/stories/<id>/image/` — рабочая страница изображений (генерация, медиа из постов, загрузка).
- `/stories/<id>/` — вкладка «Медиа для публикации» с выбором изображений и назначением главного.

## Поток работы
1. Редактор открывает страницу изображений сюжета.
2. При необходимости генерирует рекомендованный промпт (кнопка «Сгенерировать»).
3. Редактирует промпт и запускает генерацию изображения.
4. Прикрепляет результат к сюжету или выбирает файл из источников/загрузки.
5. На странице сюжета выбирает, какие изображения публиковать, и назначает одно «главным».

## Рекомендованный промпт
- Шаблон хранится в промптах проекта (`image_prompt_template`) и редактируется как остальные секции.
- Запрос к LLM формируется по этому шаблону и возвращает JSON с полем `prompt`.
- Редактор может принять рекомендацию или изменить её вручную.

## Управление изображениями
- Сюжет может содержать несколько изображений.
- `Главное` изображение всегда публикуется.
- Остальные можно включать/исключать из публикации через переключатель.
- Источник изображений:
  - `generated` — сгенерировано по промпту.
  - `upload` — загружено пользователем.
  - `source` — взято из постов.

## Публикация
- Публикуются все изображения, отмеченные как выбранные.
- Подпись/промпт изображения не отправляется в публикацию.

## Хранение
- Изображения сохраняются в `story_images/` и связываются с сюжетом.
- Главное изображение также отражается в полях `Story.image_file` для обратной совместимости.
