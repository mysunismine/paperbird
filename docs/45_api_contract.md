# API Contract

## 1. Обзор

Данный API предназначен для управления проектами, постами, сюжетами и публикациями в Telegram. API позволяет создавать, редактировать и удалять сущности, запускать задачи переписывания и генерации изображений, а также управлять публикациями. Все взаимодействия происходят через RESTful интерфейс с использованием JSON.

Для работы с API необходимо авторизоваться, получив Bearer токен, который используется в заголовках запросов. Версия API фиксирована и доступна по пути `/api/v1/`.

---

## 2. Базовые принципы

- Формат данных: JSON
- Авторизация: Bearer токен, полученный после логина, передается в заголовке `Authorization: Bearer <token>`
- Версия API: все эндпоинты начинаются с `/api/v1/`
- Стандартные коды ответов:
  - 200 OK — успешный запрос
  - 201 Created — ресурс успешно создан
  - 204 No Content — успешное удаление без тела ответа
  - 400 Bad Request — ошибка в запросе
  - 401 Unauthorized — ошибка авторизации
  - 403 Forbidden — доступ запрещен
  - 404 Not Found — ресурс не найден
  - 500 Internal Server Error — внутренняя ошибка сервера

---

## 3. Аутентификация

### Логин

- **Endpoint:** `/api/v1/auth/login`
- **Метод:** POST
- **Описание:** Получение токена для авторизации
- **Пример запроса:**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```
- **Пример успешного ответа:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```
- **Возможные ошибки:**
  - 400 Bad Request — неверный формат запроса
  - 401 Unauthorized — неверные учетные данные

### Выход (Logout)

- **Endpoint:** `/api/v1/auth/logout`
- **Метод:** POST
- **Описание:** Завершение сессии пользователя
- **Пример запроса:** (без тела)
- **Пример успешного ответа:** 204 No Content
- **Возможные ошибки:**
  - 401 Unauthorized — пользователь не аутентифицирован

### Получение текущего пользователя

- **Endpoint:** `/api/v1/auth/me`
- **Метод:** GET
- **Описание:** Получение информации о текущем пользователе
- **Пример успешного ответа:**
```json
{
  "id": 1,
  "email": "user@example.com",
  "name": "Иван Иванов"
}
```
- **Возможные ошибки:**
  - 401 Unauthorized — пользователь не аутентифицирован

---

## 4. Проекты

### Получение списка проектов

- **Endpoint:** `/api/v1/projects`
- **Метод:** GET
- **Описание:** Получение списка всех проектов пользователя
- **Пример успешного ответа:**
```json
[
  {
    "id": 1,
    "name": "Проект 1",
    "description": "Описание проекта"
  },
  {
    "id": 2,
    "name": "Проект 2",
    "description": "Описание проекта 2"
  }
]
```
- **Возможные ошибки:**
  - 401 Unauthorized

### Создание проекта

- **Endpoint:** `/api/v1/projects`
- **Метод:** POST
- **Описание:** Создание нового проекта
- **Пример запроса:**
```json
{
  "name": "Новый проект",
  "description": "Описание нового проекта"
}
```
- **Пример успешного ответа:**
```json
{
  "id": 3,
  "name": "Новый проект",
  "description": "Описание нового проекта"
}
```
- **Возможные ошибки:**
  - 400 Bad Request
  - 401 Unauthorized

### Обновление проекта

- **Endpoint:** `/api/v1/projects/{id}`
- **Метод:** PATCH
- **Описание:** Обновление данных проекта по ID
- **Пример запроса:**
```json
{
  "name": "Обновленное название"
}
```
- **Пример успешного ответа:**
```json
{
  "id": 3,
  "name": "Обновленное название",
  "description": "Описание нового проекта"
}
```
- **Возможные ошибки:**
  - 400 Bad Request
  - 401 Unauthorized
  - 404 Not Found

### Удаление проекта

- **Endpoint:** `/api/v1/projects/{id}`
- **Метод:** DELETE
- **Описание:** Удаление проекта по ID
- **Пример успешного ответа:** 204 No Content
- **Возможные ошибки:**
  - 401 Unauthorized
  - 404 Not Found

---

## 5. Посты

### Получение списка постов

- **Endpoint:** `/api/v1/posts`
- **Метод:** GET
- **Описание:** Получение списка постов с возможностью фильтрации и пагинации
- **Параметры запроса:**
  - `project_id` (optional) — фильтр по проекту
  - `page` (optional) — номер страницы (по умолчанию 1)
  - `limit` (optional) — количество постов на страницу (по умолчанию 10)
- **Пример успешного ответа:**
```json
{
  "page": 1,
  "limit": 10,
  "total": 25,
  "posts": [
    {
      "id": 101,
      "title": "Первый пост",
      "content": "Текст поста",
      "project_id": 1
    },
    {
      "id": 102,
      "title": "Второй пост",
      "content": "Еще текст",
      "project_id": 1
    }
  ]
}
```
- **Возможные ошибки:**
  - 401 Unauthorized

### Удаление поста

- **Endpoint:** `/api/v1/posts/{id}`
- **Метод:** DELETE
- **Описание:** Удаление поста по ID
- **Пример успешного ответа:** 204 No Content
- **Возможные ошибки:**
  - 401 Unauthorized
  - 404 Not Found

---

## 6. Сюжеты

### Создание сюжета

- **Endpoint:** `/api/v1/storylines`
- **Метод:** POST
- **Описание:** Создание нового сюжета
- **Пример запроса:**
```json
{
  "title": "Новый сюжет",
  "description": "Описание сюжета",
  "project_id": 1
}
```
- **Пример успешного ответа:**
```json
{
  "id": 201,
  "title": "Новый сюжет",
  "description": "Описание сюжета",
  "project_id": 1
}
```
- **Возможные ошибки:**
  - 400 Bad Request
  - 401 Unauthorized

### Получение деталей сюжета

- **Endpoint:** `/api/v1/storylines/{id}`
- **Метод:** GET
- **Описание:** Получение информации о сюжете по ID
- **Пример успешного ответа:**
```json
{
  "id": 201,
  "title": "Новый сюжет",
  "description": "Описание сюжета",
  "project_id": 1
}
```
- **Возможные ошибки:**
  - 401 Unauthorized
  - 404 Not Found

### Обновление сюжета

- **Endpoint:** `/api/v1/storylines/{id}`
- **Метод:** PATCH
- **Описание:** Обновление данных сюжета
- **Пример запроса:**
```json
{
  "description": "Обновленное описание"
}
```
- **Пример успешного ответа:**
```json
{
  "id": 201,
  "title": "Новый сюжет",
  "description": "Обновленное описание",
  "project_id": 1
}
```
- **Возможные ошибки:**
  - 400 Bad Request
  - 401 Unauthorized
  - 404 Not Found

### Удаление сюжета

- **Endpoint:** `/api/v1/storylines/{id}`
- **Метод:** DELETE
- **Описание:** Удаление сюжета по ID
- **Пример успешного ответа:** 204 No Content
- **Возможные ошибки:**
  - 401 Unauthorized
  - 404 Not Found

---

## 7. Рерайт

### Запуск задачи переписывания

- **Endpoint:** `/api/v1/rewrite`
- **Метод:** POST
- **Описание:** Запуск задачи переписывания текста
- **Пример запроса:**
```json
{
  "post_id": 101,
  "style": "formal"
}
```
- **Пример успешного ответа:**
```json
{
  "task_id": "abc123",
  "status": "queued"
}
```
- **Возможные ошибки:**
  - 400 Bad Request
  - 401 Unauthorized

### Просмотр статуса задачи

- **Endpoint:** `/api/v1/rewrite/{task_id}`
- **Метод:** GET
- **Описание:** Получение статуса задачи переписывания
- **Пример успешного ответа:**
```json
{
  "task_id": "abc123",
  "status": "completed",
  "result": "Переписанный текст..."
}
```
- **Возможные ошибки:**
  - 401 Unauthorized
  - 404 Not Found

---

## 8. Публикация

### Отправка поста в Telegram

- **Endpoint:** `/api/v1/publish`
- **Метод:** POST
- **Описание:** Немедленная публикация поста в Telegram
- **Пример запроса:**
```json
{
  "post_id": 101,
  "channel_id": "@mychannel"
}
```
- **Пример успешного ответа:**
```json
{
  "status": "published",
  "published_at": "2024-05-01T12:00:00Z"
}
```
- **Возможные ошибки:**
  - 400 Bad Request
  - 401 Unauthorized

### Отложенная публикация

- **Endpoint:** `/api/v1/publish/schedule`
- **Метод:** POST
- **Описание:** Запланировать публикацию поста на будущее время
- **Пример запроса:**
```json
{
  "post_id": 101,
  "channel_id": "@mychannel",
  "publish_at": "2024-05-01T15:00:00Z"
}
```
- **Пример успешного ответа:**
```json
{
  "status": "scheduled",
  "publish_at": "2024-05-01T15:00:00Z"
}
```
- **Возможные ошибки:**
  - 400 Bad Request
  - 401 Unauthorized

---

## 9. Генерация изображений

### Запрос генерации изображения

- **Endpoint:** `/api/v1/images/generate`
- **Метод:** POST
- **Описание:** Запуск генерации изображения по описанию
- **Пример запроса:**
```json
{
  "storyline_id": 201,
  "prompt": "Закат над горами"
}
```
- **Пример успешного ответа:**
```json
{
  "image_id": "img789",
  "status": "processing"
}
```
- **Возможные ошибки:**
  - 400 Bad Request
  - 401 Unauthorized

### Прикрепление изображения к сюжету

- **Endpoint:** `/api/v1/storylines/{id}/images`
- **Метод:** POST
- **Описание:** Прикрепление сгенерированного изображения к сюжету
- **Пример запроса:**
```json
{
  "image_id": "img789"
}
```
- **Пример успешного ответа:**
```json
{
  "storyline_id": 201,
  "image_id": "img789",
  "attached_at": "2024-05-01T13:00:00Z"
}
```
- **Возможные ошибки:**
  - 400 Bad Request
  - 401 Unauthorized
  - 404 Not Found

---

## 10. Ошибки

| Код  | Ошибка              | Описание                              | Пример ответа                           |
|-------|---------------------|-------------------------------------|---------------------------------------|
| 400   | Bad Request         | Неверный формат запроса или данные  | `{ "error": "Invalid request data" }` |
| 401   | Unauthorized        | Отсутствует или неверен токен       | `{ "error": "Unauthorized" }`          |
| 403   | Forbidden           | Доступ к ресурсу запрещен            | `{ "error": "Forbidden" }`             |
| 404   | Not Found           | Ресурс не найден                    | `{ "error": "Resource not found" }`    |
| 500   | Internal Server Error| Внутренняя ошибка сервера           | `{ "error": "Internal server error" }`|

---
