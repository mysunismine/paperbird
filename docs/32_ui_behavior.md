

# UI Behavior Specification

## 1. Обзор
Этот документ фиксирует поведение всех интерактивных элементов и сценариев пользовательского интерфейса проекта. Описаны условия доступа, навигация, работа с основными сущностями, обработка ошибок и уведомлений.

## 2. Авторизация
- Если пользователь не вошёл — доступна только страница логина.
- После 10 часов бездействия происходит автологаут.
- Страница регистрации отсутствует: пользователей создаёт администратор.
- Восстановление пароля отсутствует: при потере логина/пароля пользователь обращается к админу.

## 3. Навигация и меню
- После входа доступно основное меню: **Проекты**, **Лента**, **Сюжеты**, **Публикации**, **Профиль**.
- Навбар всегда закреплён сверху.
- На каждой странице должна быть кнопка «Выйти».

## 4. Проекты
- Список проектов представлен карточками с поиском по названию.
- На карточке показывается: название, описание, количество постов и количество сюжетов.
- Удаление проекта требует подтверждения.
- Создание проекта — одна форма с полями:
  - название
  - описание
  - целевой канал
  - источники
  - фильтры
  - частота опроса
  - срок хранения
- Управление источниками вынесено на отдельную страницу проекта: можно добавить канал по ссылке или @username, изменить или удалить существующие записи. Название и идентификатор подтягиваются автоматически фоновым воркером.

## 5. Лента постов
- По умолчанию показывает 25 постов на странице, отсортированных по дате (новые сверху).
- Фильтры: по дате, источнику, статусу обработки и языку.
- Поиск — по тексту постов.
- Превью медиа: миниатюра, открывающаяся по клику.
- Массовые действия: «Создать сюжет» и «Удалить». Панель с ними появляется сверху при выборе хотя бы одного поста.
- При клике на пост открывается полная версия с текстом, медиа, ссылками и форматированием как в оригинале.

## 6. Создание сюжета
- Сюжет создаётся из одного или нескольких постов.
- Порядок склейки: по дате возрастания, разделители между постами.
- В форме сюжета есть поля:
  - текст
  - целевой канал
  - дата публикации (опционально)
  - список прикреплённых медиа с чекбоксами
- Перед отправкой на рерайт редактор видит поле для комментариев и кнопку предпросмотра промпта.
- Полный промпт отображается в отдельном разворачивающемся блоке (редактировать его нельзя).
- Автосохранение черновика включено.
- Возможность отмены изменений отсутствует.

## 7. Рерайт и предпросмотр
- Перед публикацией обязательно наличие чекбокса «Я проверил текст». Без него кнопка «Опубликовать» неактивна.
- Предпросмотр финального поста обязателен.
- При ошибке модели сообщение отображается над формой рерайта.
- Если JSON невалидный — выполняется до 3 повторных попыток, пользователь получает уведомление о повторе.

## 8. Публикация
- Если публикация запланирована — показывается только дата и время публикации (таймер не нужен).
- После публикации показывается ссылка на опубликованный пост и статус.
- В случае ошибки Telegram — появляется уведомление и публикация отменяется.

## 9. Генерация изображений
- Переход в генерацию осуществляется через страницу `/stories/<id>/image/`.
- После генерации картинка отображается с возможностью:
  - принять и прикрепить к публикации
  - изменить комментарий и перегенерировать
  - удалить
- Редактор может держать несколько изображений на сюжет и выбирать, какие публиковать.
- Одно изображение отмечается как «главное» и всегда публикуется.
- Сгенерированные промпты не отправляются в публикацию.

## 10. Ошибки и уведомления
- Ошибки выводятся компактными плашками с красным текстом.
- Раздел со всеми ошибками отсутствует.
- Ошибки публикации, рерайта и генерации должны отображаться на соответствующих экранах.
- Уведомления об успешных действиях — зелёные плашки, исчезающие автоматически.
