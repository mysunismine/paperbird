# Error Catalog

## 1. Обзор

Каталог ошибок — это справочник, который систематизирует возможные ошибки в приложении, описывает причины их возникновения, поведение системы и рекомендации по обработке. Он помогает разработчикам быстро ориентироваться в типах ошибок, понимать, что видит пользователь, и как реагировать на них. Используется для отладки, улучшения UX и повышения надежности системы.

## 2. Классификация ошибок

Ошибки разделены на категории по области возникновения:

- Интеграция с Telegram (Telethon)
- OpenAI
- Публикация
- База данных
- Валидация
- UI (Пользовательский интерфейс)

## 3. Таблицы ошибок

### Интеграция с Telegram (Telethon)

| Code                     | Причина                                  | Что видит пользователь                  | Что пишем в лог                                    | Действие                      |
|--------------------------|-----------------------------------------|----------------------------------------|---------------------------------------------------|-------------------------------|
| TELETHON_TIMEOUT         | Таймаут при запросе к Telegram API      | "Сервис временно недоступен, попробуйте позже." | "Telethon: timeout при запросе к Telegram API"    | Ретрай 3 раза, затем уведомление |
| TELETHON_AUTH_ERROR      | Ошибка авторизации в Telegram            | "Ошибка подключения к Telegram."       | "Telethon: ошибка авторизации, проверьте ключи"   | Отмена, уведомление администратора |
| TELETHON_FLOOD_WAIT      | Превышен лимит запросов (FloodWait)     | "Слишком много запросов, подождите."  | "Telethon: FloodWait, пауза на X секунд"          | Пауза на указанный интервал, затем ретрай |

### OpenAI

| Code                     | Причина                                  | Что видит пользователь                  | Что пишем в лог                                    | Действие                      |
|--------------------------|-----------------------------------------|----------------------------------------|---------------------------------------------------|-------------------------------|
| OPENAI_API_ERROR         | Ошибка при вызове API OpenAI             | "Ошибка сервиса, попробуйте позже."    | "OpenAI: ошибка API, код ответа X"                 | Ретрай 2 раза, затем уведомление |
| OPENAI_RATE_LIMIT        | Превышен лимит запросов к OpenAI         | "Превышен лимит запросов, подождите." | "OpenAI: rate limit exceeded"                      | Пауза, затем ретрай            |
| OPENAI_INVALID_RESPONSE  | Некорректный ответ от OpenAI              | "Ошибка обработки данных."             | "OpenAI: получен некорректный ответ"               | Отмена, логирование            |

### Публикация

| Code                     | Причина                                  | Что видит пользователь                  | Что пишем в лог                                    | Действие                      |
|--------------------------|-----------------------------------------|----------------------------------------|---------------------------------------------------|-------------------------------|
| PUB_POST_FAIL            | Ошибка при публикации контента           | "Не удалось опубликовать сообщение."  | "Публикация: ошибка при отправке сообщения"       | Ретрай 2 раза, затем уведомление |
| PUB_UNAUTHORIZED         | Недостаточно прав для публикации         | "Нет прав для публикации."             | "Публикация: ошибка авторизации"                   | Отмена, уведомление            |

### База данных

| Code                     | Причина                                  | Что видит пользователь                  | Что пишем в лог                                    | Действие                      |
|--------------------------|-----------------------------------------|----------------------------------------|---------------------------------------------------|-------------------------------|
| DB_CONNECTION_FAIL       | Ошибка подключения к базе данных         | "Ошибка сервера, попробуйте позже."    | "БД: не удалось подключиться к базе данных"       | Ретрай 3 раза, затем уведомление |
| DB_QUERY_ERROR           | Ошибка выполнения запроса                 | "Ошибка сервера."                      | "БД: ошибка выполнения запроса: описание"         | Отмена, уведомление            |
| DB_DUPLICATE_ENTRY       | Нарушение уникальности записи             | "Данные уже существуют."               | "БД: попытка вставить дубликат"                    | Отмена, информирование пользователя |

### Валидация

| Code                     | Причина                                  | Что видит пользователь                  | Что пишем в лог                                    | Действие                      |
|--------------------------|-----------------------------------------|----------------------------------------|---------------------------------------------------|-------------------------------|
| VALIDATION_FAILED        | Некорректные данные пользователя         | "Некорректный ввод, проверьте данные."| "Валидация: ошибка в поле X: причина"              | Отмена, вывод ошибки пользователю |
| VALIDATION_MISSING_FIELD | Отсутствует обязательное поле             | "Заполните все обязательные поля."    | "Валидация: отсутствует поле X"                     | Отмена, вывод ошибки пользователю |

### UI (Пользовательский интерфейс)

| Code                     | Причина                                  | Что видит пользователь                  | Что пишем в лог                                    | Действие                      |
|--------------------------|-----------------------------------------|----------------------------------------|---------------------------------------------------|-------------------------------|
| UI_RENDER_ERROR          | Ошибка рендеринга интерфейса             | "Ошибка отображения страницы."         | "UI: ошибка рендеринга компонента X"               | Отмена, уведомление разработчика |
| UI_TIMEOUT               | Таймаут загрузки UI                       | "Превышено время ожидания загрузки."  | "UI: таймаут загрузки компонента X"                 | Ретрай загрузки                |

## 4. Обработка и ретраи

- По умолчанию для сетевых и интеграционных ошибок выполняется до 3 попыток (ретраев).
- При достижении лимита попыток система уведомляет администратора или пользователя (в зависимости от контекста).
- Фатальными считаются ошибки авторизации, нарушения уникальности в БД и некорректные данные пользователя — они не ретраятся.
- Для ошибок превышения лимитов (rate limits, FloodWait) предусмотрена пауза перед повторной попыткой.
- Все ошибки логируются с подробной информацией для облегчения отладки.

## 5. Лучшие практики

- Сообщения пользователю должны быть понятными, лаконичными и не содержать технических деталей.
- В логах необходимо фиксировать подробности ошибки, включая стек вызовов, коды ответов и контекст.
- Не показывайте пользователю внутренние данные или подробности, которые могут раскрыть уязвимости.
- Используйте стандартизированные коды ошибок для унификации обработки.
- При написании текстов ошибок избегайте двусмысленностей и предоставляйте рекомендации по дальнейшим действиям, если это возможно.
