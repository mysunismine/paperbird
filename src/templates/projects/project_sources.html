{% extends "base.html" %}

{% block title %}Источники проекта {{ project.name }} — Paperbird{% endblock %}

{% block content %}
  <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3 mb-4">
    <div>
      <h1 class="h3 mb-1">Источники проекта «{{ project.name }}»</h1>
      <p class="text-muted mb-0">Подключайте Telegram-каналы или веб-ленты, чтобы коллектор пополнял ленту проекта.</p>
    </div>
    <a class="btn btn-primary" href="{{ create_url }}">Добавить источник</a>
  </div>

  <div class="card shadow-sm">
    <div class="card-body">
      <h2 class="h5 mb-3">Подключённые источники</h2>
      {% if sources %}
        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th>Название</th>
                <th>Тип</th>
                <th>Идентификатор</th>
                <th>Username / Пресет</th>
                <th>Создан</th>
                <th style="width: 160px;">Действия</th>
              </tr>
            </thead>
            <tbody>
              {% for source in sources %}
                <tr>
                  <td>{{ source.title|default:"—" }}</td>
                  <td>
                    {% if source.type == "telegram" %}
                      <span class="badge text-bg-info">Telegram</span>
                    {% else %}
                      <span class="badge text-bg-success">Web</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if source.type == "telegram" %}
                      {{ source.telegram_id|default:"—" }}
                    {% else %}
                      {{ source.web_preset.name|default:"—" }}
                    {% endif %}
                  </td>
                  <td>
                    {% if source.type == "telegram" %}
                      {{ source.username|default:source.invite_link|default:"—" }}
                    {% else %}
                      {{ source.web_preset.title|default:source.web_preset.name|default:"—" }}
                    {% endif %}
                  </td>
                  <td>{{ source.created_at|date:"d.m.Y" }}</td>
                  <td>
                    <div class="d-flex gap-2">
                      <a class="btn btn-sm btn-outline-primary" href="{% url 'projects:source-edit' project.pk source.pk %}">Изменить</a>
                      <form method="post" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="action" value="delete" />
                        <input type="hidden" name="source_id" value="{{ source.pk }}" />
                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Удалить источник?');">Удалить</button>
                      </form>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted mb-0">Источники ещё не подключены.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
