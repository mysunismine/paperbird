<div class="card shadow-sm post-card" data-post-id="{{ post.id }}">
  {% if post.has_media %}
  {% with media_items=post.media_items %}
    {% if media_items %}
      {% if media_items.0.kind == "video" %}
        <a href="{{ media_items.0.url }}" target="_blank" rel="noopener" class="card-img-top d-flex align-items-center justify-content-center bg-dark text-white" style="aspect-ratio: 16/9; text-decoration: none;">
          <i class="bi bi-play-circle-fill" style="font-size: 3rem;"></i>
        </a>
      {% else %}
        <a href="{{ media_items.0.url }}" target="_blank" rel="noopener">
          <img src="{{ media_items.0.url }}" alt="Медиа поста" loading="lazy" class="card-img-top" style="object-fit: cover; max-height: 400px;" />
        </a>
      {% endif %}
    {% else %}
      <div class="card-img-top d-flex flex-column align-items-center justify-content-center bg-light-subtle text-muted" style="aspect-ratio: 16/9;">
        <i class="bi bi-film" style="font-size: 3rem;"></i>
        <p class="mb-0 small mt-2">Медиа недоступно</p>
      </div>
    {% endif %}
  {% endwith %}
{% endif %}

  <div class="card-body">
    <div class="d-flex align-items-center mb-2">
      {% if post.source.type == "telegram" %}
        <i class="bi bi-telegram text-info me-2"></i>
      {% else %}
        <i class="bi bi-globe2 text-success me-2"></i>
      {% endif %}
      <span class="fw-semibold text-body-secondary small">{{ post.source.title|default:post.source.username }}</span>
      <span class="text-muted small ms-auto">{{ post.posted_at|date:"d.m.Y H:i" }}</span>
    </div>
    <p class="card-text">{{ post.display_message|truncatewords_html:70|linebreaksbr }}</p>
  </div>

  <div class="card-footer bg-white d-flex justify-content-between align-items-center">
    <div class="form-check">
      <input type="checkbox" class="form-check-input post-select" value="{{ post.id }}" id="select-post-{{ post.id }}" />
      <label class="form-check-label" for="select-post-{{ post.id }}">Выбрать</label>
    </div>
    <div class="d-flex gap-2">
      {% if post.external_link %}
        <a href="{{ post.external_link }}" target="_blank" rel="noopener" class="btn btn-sm btn-outline-secondary" title="Открыть оригинал">
          <i class="bi bi-box-arrow-up-right"></i>
        </a>
      {% endif %}
      <a href="{% url 'feed-post-detail' project.id post.id %}" class="btn btn-sm btn-outline-secondary" title="Детали">
        <i class="bi bi-zoom-in"></i>
      </a>
    </div>
  </div>
</div>
